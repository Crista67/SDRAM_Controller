# SDRAM Controller

基于 Intel Altera EP4CE10F17C8 设计，被控芯片为 Winbond W9825G6KH-6 SDR SDRAM 芯片. 

## sdram控制器

### 1. sdram_init

用于对 sdram 进行初始化操作.

参照硬件数据手册，sdram 芯片上电后须等待 $ 200 \mu s$；随后进行预充电 (Precharge) 指令；预充电完成后需要进行 8 次自动刷新 (Auto-Refresh), 在此期间完成模式寄存器配置 (Mode Register Set).

### 2. sdram_aref

用于 sdram 的定时自动刷新.

芯片每个 bank 共有 8192 行，按照要求需要每 64ms 需要刷新 8192 次；因此刷新周期不得大于 $7.8125 \mu s$.

考虑到实际可能存在的延时，为保证刷新能够正常工作，设置刷新周期为 $7.5\mu s$, 即 750 个时钟周期.

刷新操作每 $7.5 \mu s$ 进行一次，每次须先进行预充电 (Precharge) 操作，随后进行两次自动刷新 (Auto-Refresh) 操作.

刷新操作在初始化完成后开始计时，并在计时达到最大值后向仲裁模块发出请求，收到仲裁模块的使能信号后开始刷新操作.

### 3. sdram_write

用于向 sdram 中写入数据.

传入模块的信号包括写入地址、待写入数据和突发长度.

写入突发设置为页突发，但也可以通过设置突发长度，以使数据在不满整页时提前结束突发.

写入地址共24位，按先后顺序包括写入数据存储的 bank 地址 2 位、行地址 13 位、列地址 9 位.

### 4. sdram_read

用于读取 sdram 中的数据.

传入信号包括读取地址、读使能和突发长度.

与写入模块不同的是，读取时需要手动传入读使能信号，而写使能信号是由上层模块自行发出的.

与写模块基本相同，读取模块也设置为页突发模式，突发长度和读取地址的设置也和读模块基本一致.

### 5. sdram_arbit

由于安排初始化、刷新、读、写模块的时序和优先级.

在控制器启动时，自动执行初始化操作，初始化完成信号传出后，仲裁模块开始工作；

按照模块设置，刷新模块处于最高的优先级，因此当请求信号同时传入时，优先进入刷新模块进行刷新操作.

写模块处于第二优先级，读模块处于第三优先级.

当一个模块正在工作时，此时若有其他模块的请求信号传入，正在工作的模块不会跳出，而是保持请求信号拉高，直至当前模块退出工作，随后进入发出请求的模块；此时的冲突仍遵循上述的优先级安排.

### 6. sdram_ctrl

sdram 控制模块，仲裁、初始化、读、写、自动刷新模块的顶层模块.

### 7. fifo_ctrl

fifo读写控制模块，用于在数据写入 sdram 前或读出 sdram 后的缓存，保证数据的跨时钟域传输和等待.

### 8. sdram_top

sdram 控制器顶层模块，连接 fifo 读写控制和 sdram 控制模块

## sdram 控制器外部模块

### 1. clk_gen

从quartus 调用的 PLL ip核，用于生成不同频率和相位的时钟信号，供各个模块使用. 

### 2. uart_rx 和 uart_tx

基于 rs232 协议设计，用于 sdram 控制器和上位机的通信.

设置串口波特率为 9600，传输数据位宽为 8 位，无校验位.

### 3. fifo_read

利用 fifo 将从 sdram 中读取的数据进行缓存，以便通过 uart 传输到外部.

### 4. uart_sdram

工程的顶层模块，实现了全部工程模块的例化和连接.
